@import 'tailwindcss';

/* Tailwind v4: use .dark class on html for theme toggle (not just prefers-color-scheme) */
@custom-variant dark (&:where(.dark, .dark *));

@theme {
  --font-sans: 'Inter', system-ui, ui-sans-serif, sans-serif;
}

/* Base: refined neutral backgrounds, darker dark mode */
html {
  @apply antialiased;
}
/* Focus rings for keyboard (visible only on focus-visible) */
button:focus-visible,
a:focus-visible,
input:focus-visible,
textarea:focus-visible,
select:focus-visible,
[role="button"]:focus-visible,
[role="combobox"]:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px var(--ui-bg-main), 0 0 0 4px var(--ui-accent);
  border-radius: 4px;
}
body {
  @apply min-h-screen text-zinc-800 dark:text-zinc-200;
  background-color: #fafafa;
}
.dark body {
  background-color: #0d0d0d;
}
/* Metrics graph axes/grid (light gray in light mode, subtle light in dark) */
html { --metrics-axis: #d4d4d4; --metrics-grid: #e5e5e5; }
.dark { --metrics-axis: rgba(255,255,255,0.18); --metrics-grid: rgba(255,255,255,0.08); }
/* Monospace for metrics */
.font-mono {
  font-feature-settings: "tnum";
}

/* Markdown content in message bubbles */
.prose-chat h1 { @apply text-xl font-bold mt-4 mb-2; }
.prose-chat h2 { @apply text-lg font-semibold mt-3 mb-2; }
.prose-chat h3 { @apply text-base font-semibold mt-2 mb-1; }
.prose-chat p { @apply my-2; }
.prose-chat ul { @apply list-disc pl-6 my-2; }
.prose-chat ol { @apply list-decimal pl-6 my-2; }
.prose-chat pre { @apply rounded-lg p-3 my-2 overflow-x-auto text-sm; }
.prose-chat code { @apply rounded px-1.5 py-0.5 text-sm; }
.prose-chat pre code { @apply p-0 bg-transparent; }
.prose-chat blockquote { @apply border-l-4 border-zinc-300 dark:border-zinc-600 pl-4 my-2 italic; }
.prose-chat a { @apply text-blue-600 dark:text-blue-400 underline; }

/* Assistant: thinking (light italics) vs answer (standard) when model uses think tags */
.assistant-thinking {
  font-style: italic;
  opacity: 0.85;
  color: var(--ui-text-secondary);
}
.assistant-answer {
  font-style: normal;
}

/* Accent: American flag red with contrasting bright orbit colors */
:root {
  --atom-accent: #B22234;
  --atom-accent-light: #E03c51;
  --atom-teal: #06b6d4;
  --atom-amber: #f59e0b;
}
.dark {
  --atom-accent: #DC143C;
  --atom-accent-light: #E03c51;
  --atom-teal: #22d3ee;
  --atom-amber: #fbbf24;
}

/* Thinking indicator: sleek minimal atom – theme accent, GPU-friendly animation */
@keyframes atom-nucleus-pulse {
  0%, 100% { opacity: 0.6; }
  50% { opacity: 1; }
}
@keyframes atom-orbit-spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
@keyframes atom-orbit-spin-reverse {
  from { transform: rotate(360deg); }
  to { transform: rotate(0deg); }
}
.thinking-atom-icon {
  display: block;
  /* Nucleus glow uses theme accent so it contrasts with any background */
  --atom-nucleus-glow: color-mix(in srgb, var(--ui-accent) 70%, transparent);
  filter: drop-shadow(0 0 6px var(--atom-nucleus-glow)) drop-shadow(0 0 10px var(--atom-nucleus-glow));
}
.thinking-atom-nucleus {
  fill: var(--ui-accent);
  transform-origin: 16px 16px;
  animation: atom-nucleus-pulse 2s ease-in-out infinite;
  filter: drop-shadow(0 0 4px var(--ui-accent));
}
.thinking-atom-orbit,
.thinking-atom-orbit-2,
.thinking-atom-orbit-3 {
  transform-origin: 16px 16px;
  stroke-width: 1.5;
  stroke-linecap: round;
  fill: none;
  opacity: 1;
}
.thinking-atom-orbit {
  stroke: #00f0ff;
  animation: atom-orbit-spin 4s linear infinite;
}
.thinking-atom-orbit-2 {
  stroke: #ff00ff;
  animation: atom-orbit-spin-reverse 3s linear infinite;
}
.thinking-atom-orbit-3 {
  stroke: #00ff00;
  animation: atom-orbit-spin 5s linear infinite;
}
@media (prefers-reduced-motion: reduce) {
  .thinking-atom-icon .thinking-atom-nucleus,
  .thinking-atom-icon .thinking-atom-orbit,
  .thinking-atom-icon .thinking-atom-orbit-2,
  .thinking-atom-icon .thinking-atom-orbit-3 {
    animation: none;
  }
  .thinking-atom-icon .thinking-atom-nucleus {
    opacity: 1;
  }
}

/* ATOM logo (static, theme-aware – used next to wordmark in header and splash) */
.atom-logo-icon {
  display: block;
}
.atom-logo-nucleus {
  fill: var(--atom-accent);
}
.atom-logo-orbit-1 {
  stroke: var(--atom-accent-light);
}
.atom-logo-orbit-2 {
  stroke: var(--atom-teal);
}
.atom-logo-orbit-3 {
  stroke: var(--atom-amber);
}

/* Max tokens: hide native spinner so only double/half buttons are used */
.max-tokens-step-input::-webkit-inner-spin-button,
.max-tokens-step-input::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
.max-tokens-step-input {
  -moz-appearance: textfield;
  appearance: textfield;
}
.batch-size-step-input::-webkit-inner-spin-button,
.batch-size-step-input::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
.batch-size-step-input {
  -moz-appearance: textfield;
  appearance: textfield;
}

/* Panel tabs: open/close side panels — larger, higher contrast, optional label */
.panel-tab {
  position: absolute;
  width: 32px;
  min-width: 32px;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--ui-border);
  background: color-mix(in srgb, var(--ui-accent) 8%, var(--ui-bg-sidebar));
  color: var(--ui-accent);
  cursor: pointer;
  transition: background-color 0.2s, color 0.2s, box-shadow 0.2s;
  z-index: 10;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
}
.panel-tab:hover {
  background: color-mix(in srgb, var(--ui-accent) 18%, var(--ui-bg-sidebar));
  color: var(--ui-text-primary);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
}
.panel-tab:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px var(--ui-bg-main), 0 0 0 4px var(--ui-accent);
}
.panel-tab svg {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}
.panel-tab-strip-label {
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 0.02em;
  writing-mode: vertical-rl;
  text-orientation: mixed;
  transform: rotate(180deg);
  color: var(--ui-accent);
  opacity: 0.95;
  line-height: 1.2;
}
.panel-tab-strip-icon {
  width: 20px;
  height: 20px;
  color: var(--ui-accent);
  flex-shrink: 0;
}
/* Same height on both strips: icon sits just a small gap above the arrow tab (tab is 64px tall, centered at 50%) */
.panel-tab-strip-icon-wrap {
  position: absolute;
  left: 0;
  right: 0;
  top: calc(50% - 62px);
  height: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
}
/* In Arena layout, left sidebar is secondary to the main content */
.arena-sidebar-secondary {
  border-color: color-mix(in srgb, var(--ui-border) 70%, transparent);
  background-color: color-mix(in srgb, var(--ui-bg-sidebar) 95%, var(--ui-bg-main));
}
@keyframes panel-tab-bounce {
  0% { transform: var(--panel-tab-transform) scale(1); }
  40% { transform: var(--panel-tab-transform) scale(1.15); }
  70% { transform: var(--panel-tab-transform) scale(0.97); }
  100% { transform: var(--panel-tab-transform) scale(1); }
}
.panel-tab-bounce {
  animation: panel-tab-bounce 0.4s ease-out;
}

/* Micro-animations (subtle system feedback) */
@keyframes ui-input-breathe {
  0%, 100% { transform: scale(1); box-shadow: 0 0 0 rgba(0,0,0,0); }
  50% { transform: scale(1.008); box-shadow: 0 0 18px rgba(220, 38, 38, 0.08); }
}
.ui-input-breathe {
  animation: ui-input-breathe 3.6s ease-in-out infinite;
}

@keyframes ui-odometer-scan {
  0% { background-position-y: 0; }
  100% { background-position-y: 6px; }
}
.ui-odometer {
  position: relative;
  display: inline-block;
  font-variant-numeric: tabular-nums;
  letter-spacing: 0.02em;
}
.ui-odometer-active::after {
  content: '';
  position: absolute;
  inset: -2px -3px;
  background: repeating-linear-gradient(
    0deg,
    rgba(220, 38, 38, 0.25) 0,
    rgba(220, 38, 38, 0.25) 1px,
    transparent 1px,
    transparent 3px
  );
  opacity: 0.35;
  mix-blend-mode: multiply;
  pointer-events: none;
  animation: ui-odometer-scan 0.8s linear infinite;
}

@keyframes ui-gpu-pulse {
  0% { transform: translateX(-120%); opacity: 0.25; }
  50% { opacity: 0.85; }
  100% { transform: translateX(220%); opacity: 0.25; }
}
/* Sparkline for tokens/sec */
.ui-sparkline {
  display: block;
}
.ui-sparkline-line {
  stroke: rgba(148, 163, 184, 0.6);
  stroke-width: 1.2;
}
.ui-sparkline-active {
  stroke: rgba(220, 38, 38, 0.9);
}

/* Command palette (Ctrl+K): backdrop blur + scale-in */
@keyframes command-palette-in {
  from {
    opacity: 0;
    transform: scale(0.96);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
.command-palette-backdrop {
  background: rgba(0, 0, 0, 0.4);
  -webkit-backdrop-filter: blur(8px);
  backdrop-filter: blur(8px);
}
.command-palette-modal {
  animation: command-palette-in 0.2s ease-out;
}

/* Message entrance: subtle fade + slide */
@keyframes message-entrance {
  from {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
/* Message entrance: handled by Svelte in:fly on MessageBubble (see MessageBubble.svelte).
   Class kept for any layout; animation removed so Svelte transition is visible. */
.message-entrance {
  /* was: animation: message-entrance 0.25s ease-out; */
}

/* Cockpit Intel panel: slide in from right */
@keyframes intel-panel-in {
  from {
    opacity: 0;
    transform: translateX(12px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}
.intel-panel-enter {
  animation: intel-panel-in 0.2s ease-out;
}

/* Convo rail width transition is inline (transition-[width] duration-200) */

/* User bubble: theme-tinted, translucent */
.ui-user-bubble {
  background-color: var(--ui-accent);
  background-color: color-mix(in srgb, var(--ui-accent) 20%, transparent);
  color: var(--ui-text-primary);
  border: 1px solid var(--ui-accent);
  border-color: color-mix(in srgb, var(--ui-accent) 35%, transparent);
  -webkit-backdrop-filter: blur(6px);
  backdrop-filter: blur(6px);
}

@media (prefers-reduced-motion: reduce) {
  .ui-input-breathe,
  .ui-odometer-active::after,
  .ui-gpu-meter-active::after {
    animation: none !important;
  }
}

/* ========== UI theme variables (3 themes: Lavender, Sage, Obsidian) ========== */

/* Lavender — Digital Lavender + mint (2026 wellness/calm tech). Calm, trust, prolonged sessions. */
[data-ui-theme="lavender"] {
  --ui-bg-main: #f8f6fc;
  --ui-bg-sidebar: #f0ecf8;
  --ui-accent: #8b7ab8;
  --ui-accent-hot: #a855f7;
  --ui-accent-cool: #a78bfa;
  --ui-text-primary: #1e1b2e;
  --ui-text-secondary: #5c5676;
  --ui-border: rgba(139, 122, 184, 0.2);
  --ui-sidebar-active: #e8e4f0;
  --ui-sidebar-hover: #ebe8f2;
  --ui-input-bg: #ffffff;
  --ui-input-border: #e0dce8;
  --ui-glow: rgba(139, 122, 184, 0.2);
  --atom-accent: #8b7ab8;
  --atom-accent-light: #a78bfa;
  --atom-teal: #6ee7c0;
  --atom-amber: #c4b5fd;
}
.dark[data-ui-theme="lavender"] {
  --ui-bg-main: #1a1820;
  --ui-bg-sidebar: #221f2a;
  --ui-accent: #c4b5fd;
  --ui-accent-hot: #e879f9;
  --ui-accent-cool: #a78bfa;
  --ui-text-primary: #f5f3f7;
  --ui-text-secondary: #a8a2b3;
  --ui-border: rgba(196, 181, 253, 0.15);
  --ui-sidebar-active: #2d2935;
  --ui-sidebar-hover: #352f40;
  --ui-input-bg: #221f2a;
  --ui-input-border: #3d3748;
  --ui-glow: rgba(196, 181, 253, 0.2);
  --atom-accent: #c4b5fd;
  --atom-accent-light: #ddd6fe;
  --atom-teal: #6ee7c0;
  --atom-amber: #c4b5fd;
}

/* Sage — Eco-brutalism / grounded neutrals (2026 credibility). Organic, minimal, honest. */
[data-ui-theme="sage"] {
  --ui-bg-main: #f6f5f2;
  --ui-bg-sidebar: #ebe9e4;
  --ui-accent: #6b7c5a;
  --ui-accent-hot: #8b7355;
  --ui-accent-cool: #5c6b4a;
  --ui-text-primary: #2d2a26;
  --ui-text-secondary: #5a5650;
  --ui-border: #c5bfb4;
  --ui-sidebar-active: #e2dfd8;
  --ui-sidebar-hover: #d8d4cc;
  --ui-input-bg: #ffffff;
  --ui-input-border: #c5bfb4;
  --ui-glow: rgba(107, 124, 90, 0.18);
  --atom-accent: #6b7c5a;
  --atom-accent-light: #8a9b76;
  --atom-teal: #6b7c5a;
  --atom-amber: #8b7355;
}
.dark[data-ui-theme="sage"] {
  --ui-bg-main: #1c1b18;
  --ui-bg-sidebar: #262420;
  --ui-accent: #8a9b76;
  --ui-accent-hot: #b8986b;
  --ui-accent-cool: #7a8c65;
  --ui-text-primary: #e8e6e1;
  --ui-text-secondary: #9a968e;
  --ui-border: #3d3a35;
  --ui-sidebar-active: #2f2d28;
  --ui-sidebar-hover: #38352e;
  --ui-input-bg: #262420;
  --ui-input-border: #3d3a35;
  --ui-glow: rgba(138, 155, 118, 0.2);
  --atom-accent: #8a9b76;
  --atom-accent-light: #a8b892;
  --atom-teal: #8a9b76;
  --atom-amber: #b8986b;
}

/* Obsidian — Dark Mode 2.0 (2026). Deep charcoal + navy depth, no pure black. OLED-friendly. */
[data-ui-theme="obsidian"] {
  --ui-bg-main: #16181d;
  --ui-bg-sidebar: #1c1f26;
  --ui-accent: #5eead4;
  --ui-accent-hot: #f472b6;
  --ui-accent-cool: #2dd4bf;
  --ui-text-primary: #e2e8f0;
  --ui-text-secondary: #94a3b8;
  --ui-border: #2d333b;
  --ui-sidebar-active: #252930;
  --ui-sidebar-hover: #2a2e36;
  --ui-input-bg: #1c1f26;
  --ui-input-border: #334155;
  --ui-glow: rgba(94, 234, 212, 0.22);
  --atom-accent: #5eead4;
  --atom-accent-light: #99f6e4;
  --atom-teal: #2dd4bf;
  --atom-amber: #fcd34d;
}
.dark[data-ui-theme="obsidian"] {
  --ui-bg-main: #0f1114;
  --ui-bg-sidebar: #15181e;
  --ui-accent: #67e8f9;
  --ui-accent-hot: #f9a8d4;
  --ui-accent-cool: #22d3ee;
  --ui-text-primary: #f1f5f9;
  --ui-text-secondary: #94a3b8;
  --ui-border: #1e293b;
  --ui-sidebar-active: #1a1f28;
  --ui-sidebar-hover: #1f242d;
  --ui-input-bg: #15181e;
  --ui-input-border: #334155;
  --ui-glow: rgba(103, 232, 249, 0.25);
  --atom-accent: #67e8f9;
  --atom-accent-light: #a5f3fc;
  --atom-teal: #22d3ee;
  --atom-amber: #fde047;
}


/* Splash: ATOM wordmark above headline */
.ui-splash-branding {
  font-size: 1.25rem;
  line-height: 1;
  font-weight: 600;
  letter-spacing: 0.2em;
  color: var(--ui-accent);
  opacity: 0.9;
}

/* Splash: gradient fade divider (replaces star divider) */
.ui-splash-divider {
  height: 2px;
  background: linear-gradient(to right, transparent, var(--ui-accent) 50%, transparent);
  opacity: 0.3;
}

/* Splash: subtle fade-in on load */
.ui-splash-wrap {
  animation: ui-splash-fade-in 0.4s ease-out;
}
@keyframes ui-splash-fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}


/* Theme-aware utilities (glow, etc.) */
.ui-input-glow:focus-within {
  border-color: var(--ui-accent-cool, var(--ui-accent));
  box-shadow: 0 0 15px var(--ui-glow);
}
.ui-input-glow textarea::placeholder {
  color: var(--ui-text-secondary);
  opacity: 0.9;
}
.ui-btn-accent {
  background: var(--ui-accent);
  color: var(--ui-bg-main);
  box-shadow: 0 4px 15px var(--ui-glow);
  transition: all 0.15s ease;
}
.ui-btn-accent:hover {
  box-shadow: 0 6px 20px var(--ui-glow);
  transform: translateY(-1px);
}
.ui-sidebar-active {
  border-left: 3px solid var(--ui-accent-cool, var(--ui-accent));
  background: linear-gradient(90deg, var(--ui-glow) 0%, transparent 100%);
}
.ui-pill-suggestion {
  color: var(--ui-accent);
  border-color: var(--ui-accent);
  background: transparent;
  transition: all 0.15s ease;
}
.ui-pill-suggestion:hover {
  background: var(--ui-accent);
  color: var(--ui-bg-main);
}
.ui-model-selector-open {
  border-color: var(--ui-accent-cool, var(--ui-accent)) !important;
}

/* ========== Dynamic UI (theme/layout transitions, animations) ========== */
/* Revert: see docs/ATOM-DYNAMIC-UI-UNDO.md */

/* 400ms theme switch transition */
html {
  transition: background-color 400ms ease, color 400ms ease;
}
body {
  transition: background-color 400ms ease;
}

/* 300ms layout/panel transitions */
.atom-layout-transition,
.atom-panel-wrap {
  transition: width 300ms ease, min-width 300ms ease, grid-template-columns 300ms ease, opacity 300ms ease;
}
/* Arena model card when that slot is currently responding */
.model-card-active {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Arena question bar: unified strip */
.arena-question-bar {
  --arena-bar-bg: var(--ui-input-bg);
}

/* Q1, model names, and bar controls: clear sans-serif for readability */
.arena-question-bar,
.arena-question-bar *,
.ui-model-selector,
.ui-model-selector * {
  font-family: var(--font-sans);
}

.arena-web-tab {
  color: var(--ui-text-secondary);
  background: transparent;
  transition: background 0.15s, color 0.15s, border-color 0.15s;
}
.arena-web-tab:hover:not(.active) {
  color: var(--ui-text-primary);
  background: color-mix(in srgb, var(--ui-accent) 8%, transparent);
}
.arena-web-tab.active {
  background: color-mix(in srgb, var(--ui-accent) 14%, transparent);
  color: var(--ui-accent);
  font-weight: 600;
}

/* Arena globe button (web connect/disconnect) */
.arena-globe-btn:disabled { opacity: 0.5; cursor: not-allowed; }
.arena-globe-spin { animation: arena-globe-spin 1.2s linear infinite; }
@keyframes arena-globe-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
.arena-globe-dot {
  position: absolute;
  bottom: 2px;
  left: 2px;
  width: 7px;
  height: 7px;
  border-radius: 50%;
  pointer-events: none;
}
.arena-globe-dot-green { background: #22c55e; }
.arena-globe-dot-red { background: #dc2626; }
.arena-globe-dot-pulse { animation: arena-globe-dot-pulse 1.2s ease-in-out infinite; }
@keyframes arena-globe-dot-pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

/* Arena control bar: sections + dividers */
.arena-bar-section { padding: 0 0.25rem; }
.arena-bar-divider {
  width: 1px;
  height: 1.25rem;
  flex-shrink: 0;
  background-color: var(--ui-border);
  opacity: 0.8;
}

/* Arena question panel: resize handles (edge/corner) */
.arena-resize-handle:hover { background-color: color-mix(in srgb, var(--ui-accent) 30%, transparent) !important; }

/* Streaming: pulsing border glow */
.atom-streaming-glow {
  animation: atom-streaming-glow 1.5s ease-in-out infinite;
}
@keyframes atom-streaming-glow {
  0%, 100% { box-shadow: 0 0 0 1px var(--ui-border), 0 0 12px rgba(6, 182, 212, 0.2); }
  50% { box-shadow: 0 0 0 1px var(--atom-teal), 0 0 20px rgba(6, 182, 212, 0.4); }
}

/* Response complete: brief green flash */
.atom-complete-flash {
  animation: atom-complete-flash 500ms ease-out forwards;
}
@keyframes atom-complete-flash {
  0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.5); }
  40% { box-shadow: 0 0 0 8px rgba(34, 197, 94, 0.15); }
  100% { box-shadow: 0 0 0 0 transparent; }
}

/* Error: red shake */
.atom-error-shake {
  animation: atom-error-shake 0.4s ease-in-out;
}
@keyframes atom-error-shake {
  0%, 100% { transform: translateX(0); }
  15% { transform: translateX(-6px); }
  30% { transform: translateX(5px); }
  45% { transform: translateX(-4px); }
  60% { transform: translateX(3px); }
  75% { transform: translateX(-2px); }
}

/* Subtle animated gradient background (15s loop, low opacity). Disabled in .atom-performance-mode */
.atom-gradient-bg::before {
  content: '';
  position: fixed;
  inset: 0;
  z-index: -1;
  opacity: 0.06;
  background: linear-gradient(
    135deg,
    var(--atom-teal) 0%,
    transparent 30%,
    var(--atom-accent) 50%,
    transparent 70%,
    var(--atom-amber) 100%
  );
  background-size: 200% 200%;
  animation: atom-gradient-drift 15s ease-in-out infinite;
  pointer-events: none;
}
.atom-performance-mode .atom-gradient-bg::before {
  display: none;
}
@keyframes atom-gradient-drift {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

/* ── Theme-aware accent for checkboxes and sliders ── */
.accent-themed {
  accent-color: var(--ui-accent);
}

/* Reduced motion: disable or shorten animations */
@media (prefers-reduced-motion: reduce) {
  html, body { transition-duration: 0.01ms; }
  .atom-layout-transition,
  .atom-panel-wrap { transition-duration: 0.01ms; }
  .atom-streaming-glow { animation: none; box-shadow: 0 0 0 1px var(--ui-border); }
  .atom-complete-flash { animation: none; }
  .atom-error-shake { animation: none; }
  .atom-gradient-bg::before { animation: none; }
}
